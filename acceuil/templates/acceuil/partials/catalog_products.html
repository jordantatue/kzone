<div class="row g-3">
    {% for produit in produits %}
        <div class="col-6 col-lg-4 col-xxl-3">
            <article class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden home-page__product-card">
                <div class="position-relative">
                    <div id="product-carousel-{{ produit.id }}" class="carousel slide home-page__product-carousel" data-bs-touch="true" data-bs-interval="false">
                        <div class="carousel-inner">
                            {% for image in produit.images.all %}
                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                    <img src="{{ image.image.url }}" class="d-block w-100 home-page__product-image" alt="{{ produit.titre }}">
                                </div>
                            {% empty %}
                                <div class="carousel-item active">
                                    <img src="https://placehold.co/640x420/e9ecef/6c757d?text=K-Zone" class="d-block w-100 home-page__product-image" alt="Image par defaut">
                                </div>
                            {% endfor %}
                        </div>
                        {% if produit.images.all|length > 1 %}
                            <button class="carousel-control-prev" type="button" data-bs-target="#product-carousel-{{ produit.id }}" data-bs-slide="prev" aria-label="Image precedente">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#product-carousel-{{ produit.id }}" data-bs-slide="next" aria-label="Image suivante">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            </button>
                        {% endif %}
                    </div>
                    <button
                        type="button"
                        class="btn btn-light rounded-circle shadow-sm home-page__favorite-btn js-favorite-toggle"
                        data-product-id="{{ produit.id }}"
                        aria-label="Basculer favori"
                        aria-pressed="false"
                    >
                        <i class="bi bi-heart" aria-hidden="true"></i>
                    </button>
                </div>

                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-start gap-2 mb-2">
                        <h3 class="h6 card-title mb-0 fw-bold">{{ produit.titre }}</h3>
                        {% if produit.vendeur.profil_utilisateur.type_vendeur == "professionnel" %}
                            <span class="badge text-bg-primary">Professionnel</span>
                        {% else %}
                            <span class="badge text-bg-light">Particulier</span>
                        {% endif %}
                    </div>

                    <p class="home-page__price mb-1">{{ produit.prix|floatformat:0 }} FCFA</p>
                    <p class="text-muted small mb-1">{{ produit.lieu_vente.ville }}, {{ produit.lieu_vente.quartier }}</p>
                    <p class="text-muted small mb-2">Maj il y a {{ produit.date_mise_a_jour|default:produit.date_creation|timesince }}</p>

                    {% if produit.description %}
                        <p class="small text-body-secondary mb-2">{{ produit.description|truncatechars:70 }}</p>
                    {% endif %}

                    <div class="mt-auto d-flex justify-content-between align-items-center">
                        <span class="badge rounded-pill text-bg-light">{{ produit.categorie.nom }}</span>
                        {% if produit.produit_retail %}
                            <span class="small fw-semibold">{{ produit.produit_retail.etat|title }}</span>
                        {% endif %}
                        {% if produit.produit_agricole %}
                            <span class="small fw-semibold">{{ produit.produit_agricole.region_origine }}</span>
                        {% endif %}
                    </div>
                </div>
            </article>
        </div>
    {% empty %}
        <div class="col-12">
            <div class="alert alert-light border mb-0">
                Aucun produit ne correspond aux filtres selectionnes.
            </div>
        </div>
    {% endfor %}
</div>

